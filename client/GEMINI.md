# Gemini 대화 기록

**지침:** 사용자와의 대화 내용을 이 파일에 기록하여 다음 상호작용 시 참고합니다. 이 지침은 항상 파일의 맨 위에 유지합니다.

**핵심 지침:** 중요한 작업 단위를 완료한 후에는, 작업 내용의 요약을 이 파일(`GEMINI.md`)에 항상 기록하여 대화의 맥락을 유지한다.

---

### 2025-09-19

**주제:** C++ 서버와 Python AI 연동 방식 논의

**요약:**
*   사용자는 Python AI 로직을 C++로 변환하는 것의 어려움을 인지하고, C++ 서버와 Python AI를 분리하는 하이브리드 방식을 문의함.
*   연동 방식으로는 REST API와 Subprocess가 논의되었으며, 사용자는 Subprocess 방식을 선호한다고 언급함.
*   `RPS_Game.py` 파일 분석을 통해, 실제로는 단순 AI가 아닌 OpenCV/MediaPipe를 사용한 컴퓨터 비전 프로젝트임을 확인함. 이에 따라 C++로의 완전 변환은 비현실적이라 판단.
*   이 대화 내용을 `GEMINI.md`에 기록하도록 요청받음.

---

### 2025-09-19 (진행)

**주제:** C++/Python Subprocess 예제 생성

**요약:**
*   사용자의 요청에 따라, C++(`main.cpp`)가 Python(`detection.py`)을 자식 프로세스로 실행하는 예제를 작성함.
*   Python은 OpenCV/MediaPipe를 사용해 손 모양을 감지하고, C++는 그 결과를 받아 터미널에 출력하는 구조.
*   원본 `RPS_Game.py`는 수정하지 않고, `main.cpp`와 `detection.py`를 새로 생성하여 작업을 완료함.

---

### 2025-09-19 (진행)

**주제:** C++ 프로그램 기능 강화 및 안정성 향상

**요약:**
*   **의존성 관리 자동화:** C++ 프로그램 실행 시 Python 의존성을 자동 확인하고, 사용자 동의 하에 `pip`으로 설치하는 기능을 구현. 로직이 복잡해짐에 따라 `check_dependency.cpp` 파일로 분리.
*   **`requirements.txt` 안정화:** `mediapipe`와 `opencv-python`의 `numpy` 버전 충돌 문제를 해결. `pip`의 의존성 해결 기능을 이용해 호환되는 버전 조합을 찾아낸 후, 해당 버전들을 `requirements.txt`에 고정하여 재현성을 확보.
*   **에러 핸들링 강화:** `pclose`의 종료 코드를 확인하여, Python 스크립트 내부에서 발생하는 에러(예: 모듈 로딩 실패)를 C++ 프로그램이 감지하고 사용자에게 알리도록 개선.
*   **빌드 시스템 도입:** `Makefile`을 추가하여 `make` 명령어로 프로젝트를 쉽게 빌드하고 정리할 수 있도록 자동화.
*   **지속적인 맥락 유지:** 이 모든 작업 내용을 `GEMINI.md`에 기록하도록 지시받음.

---

### 2025-09-19 (진행)

**주제:** Qt 연동을 위한 C++ 클라이언트 기능 개선

**요약:**
*   **의존성 자동 설치:** `check_dependency.cpp`를 수정하여, Python 의존성 패키지가 없을 경우 사용자에게 묻지 않고 자동으로 설치를 진행하도록 변경.
*   **데이터/로그 채널 분리:** Qt 애플리케이션과의 안정적인 통신을 위해, C++ 프로그램의 `stdout`은 순수 데이터 전용, `stderr`는 모든 상태 및 에러 메시지 전용으로 분리하는 작업을 시작. (`check_dependency.cpp`에 적용 완료, `main.cpp`에 적용 중)

---

### 2025-09-19 (최종 요약)

**주제:** Qt 연동을 위한 C++ 클라이언트 애플리케이션 최종 개선 및 사용 가이드

**요약:**
*   **클라이언트 최적화:** C++ 프로그램이 Qt 애플리케이션의 클라이언트로 작동하도록 최종 개선 완료.
*   **비대화형 의존성 관리:** Python 의존성 패키지 누락 시 사용자에게 묻지 않고 자동으로 설치 진행. 모든 관련 상태 메시지는 `stderr`로 출력.
*   **명확한 데이터 출력:** 감지된 손 모양("Rock", "Paper", "Scissors")과 같은 순수 데이터만 `stdout`으로 출력. Qt 애플리케이션이 파싱하기 용이하도록 스트림을 깨끗하게 유지.
*   **포괄적인 로그:** 의존성 확인, Python 스크립트 시작/종료, 에러 등 모든 상태 및 로그 메시지는 `stderr`로 출력. Qt 애플리케이션이 로그를 표시하거나 상태를 업데이트하는 데 활용 가능.
*   **강화된 에러 보고:** Python 스크립트 실패 시 C++ 프로그램이 종료 코드를 `stderr`로 보고.
*   **빌드 자동화:** `Makefile`을 통해 프로젝트 빌드 및 정리 자동화.
*   **재현 가능한 환경:** `requirements.txt` 파일이 호환되는 버전으로 고정되어 일관된 의존성 설치 보장.

---

### 2025-09-22

**주제:** Qt GUI와 C++ 클라이언트 연동

**요약:**
*   **Qt/C++ 연동:** `QProcess`를 사용하여 Qt GUI에서 C++ 클라이언트(`client/main`)를 실행하고, `stdout`/`stderr`를 통해 비동기적으로 통신하는 기능을 구현.
*   **작업 디렉토리 문제 해결:** `client/main` 프로세스의 작업 디렉토리를 `client/`로 명시적으로 설정하여, `requirements.txt`와 같은 상대 경로 파일을 올바르게 찾도록 수정.
*   **코드 리팩토링:** `deprecated`된 `QProcess::start()` API를 `setProgram()`/`start()`를 사용하는 최신 Qt 방식으로 개선.
*   **버전 관리:** 완성된 코드를 `pang0620` 브랜치에 커밋 및 푸시 완료. `.gitignore`에 Qt 사용자 설정 파일(`*.pro.user*`)을 추가하여 불필요한 파일 추적을 방지.

---

### 2025-09-22 (수정 및 현재 상태)

**주제:** Qt GUI, 게임 서버 연동 및 전체 플레이 로직 구현

**요약:**
*   **TCP/IP 서버 연동:** Qt GUI(`mainwidget`)에 `QTcpSocket`을 사용하여 게임 서버와의 TCP/IP 통신 기능을 구현. GUI는 이제 서버에 연결하고, 사용자 인증을 수행하며, `START_ROUND`, `RESULT`와 같은 게임 프로토콜 메시지를 처리.
*   **서버 기반 게임 루프:** 로컬에서 임의로 실행되던 C++ 손 모양 감지 클라이언트(`client/main`)가 이제 서버로부터 `START_ROUND` 명령을 받아야만 시작되도록 게임의 핵심 로직이 변경됨. 감지된 손 모양은 다시 서버로 전송.
*   **안정적인 손 모양 감지 및 재시도:** 손 모양 감지 클라이언트가 유효한 값(Rock, Paper, Scissors)을 반환하지 못하고 종료될 경우, GUI가 이를 감지하여 유효한 손 모양이 서버에 전송될 때까지 클라이언트 프로세스를 자동으로 재시작하는 강력한 재시도 메커니즘을 구현.
*   **UI 개선:** 상대방의 비디오 스트림을 표시하기 위한 두 번째 `graphicsView`를 추가하고, 게임 상태(라운드 시작, 종료 등)에 따라 UI가 동적으로 업데이트되도록 개선.
*   **클라이언트 로직 변경:** `client/main.cpp`는 Python 스크립트를 호출하는 대신, `HandDetector` C++ 클래스를 직접 사용하여 감지를 수행하고 결과만 `stdout`으로 출력하도록 기능이 변경/단순화됨.
*   **미사용 코드:** Python 의존성을 관리하던 `check_dependency.cpp` 코드는 소스 트리에는 남아있으나, 현재의 `client/main` 실행 파일에서는 더 이상 호출되지 않음.
*   **버전 관리 상태:** 상기된 서버 연동 및 게임 플레이 로직과 관련된 핵심 변경사항(`gui/mainwidget.cpp`, `gui/mainwidget.h`)이 현재 작업 디렉토리에서 **커밋되지 않은 상태**로 남아있음.

---

### 2025-09-22 (진행)

**주제:** GUI 워크플로우 리팩토링 및 상태 관리 강화

**요약:**
*   **사용자 요청 기반 리팩토링:** 사용자의 구체적인 요구사항에 맞춰 GUI의 핵심 동작 방식을 재설계.
*   **역할 분리:**
    *   **`Camera Open` 버튼:** 이제 '카메라 시작'과 '서버 연결'의 두 가지 역할을 동시에 수행.
    *   **`Ready` 버튼:** 더 이상 서버에 연결하지 않음. 대신, 감지된 손 모양을 서버에 **수동으로 전송**하는 역할만 담당.
*   **상태 관리 강화:**
    *   버튼의 활성화/비활성화 상태를 게임 흐름(연결 전, 연결 후, 라운드 시작 후 등)에 맞춰 동적으로 관리하여 사용자의 혼란을 막고 논리적 오류를 방지.
    *   예: `Camera Open` 클릭 시 비활성화, `START_ROUND` 수신 시 `Ready` 버튼 활성화, `Ready` 클릭 시 다시 비활성화.
*   **비동기 로직 변경:** 손 모양이 감지되어도 자동으로 전송되지 않음. 감지된 값은 변수에 저장되고, 사용자가 `Ready` 버튼을 눌러야만 서버로 전송되도록 수정하여, 감지와 전송 로직을 완전히 분리.
---

### 2025-09-22 (추가 수정 및 안정화)

**주제:** GUI 자동 재시도 로직 수정 및 안정성 강화

**요약:**
*   **선별적 재시도 로직 구현:** `onProcessFinished` 핸들러의 로직을 대폭 수정하여, 손 모양 감지 클라이언트의 재시도 조건을 명확히 함.
    *   **성공 시 대기:** 유효한 손 모양("Rock", "Paper", "Scissors")이 감지되면, 더 이상 자동 재시도를 하지 않고 사용자가 "Ready" 버튼을 누를 때까지 대기하도록 변경.
    *   **실패 시 재시도:** 유효하지 않은 값("Nothing", "Unknown")이 감지되었을 경우에만 클라이언트 프로세스를 자동으로 재시작하여, 불필요한 재시도 루프를 막음.
*   **클라이언트 출력 파싱:** `client/main`의 표준 출력 형식(`C++ | Detected Gesture: [Rock]`)에서 순수한 제스처(`Rock`)만 정확히 추출하도록 `onReadyReadStandardOutput` 핸들러를 수정. 이를 통해 재시도 조건이 올바르게 동작하도록 함.
*   **안정성 강화:**
    *   라운드 시작 또는 재시도 시 이전에 감지되었던 손 모양 값을 깨끗하게 초기화하여, 이전 라운드의 값이 실수로 사용되는 버그를 방지.
    *   프로세스 재시도 시 사용되던 잘못된 상대 경로를 수정하여 안정성을 높임.
